#!/usr/bin/env python
import re
import sys

def main():
    write(translate(read()))

def read():
    return [line.strip() for line in sys.stdin]

def translate(lines):
    return add_wrapper(convert(fold_stage_directions(filter_text(remove_empty(lines)))))

def remove_empty(lines):
    return filter(None, lines)

def filter_text(lines):
    start = lines.index('ACT 1. SCENE 1.1.')
    end = lines.index('*****')
    return lines[start:end]

def fold_stage_directions(lines):
    result = []
    in_stage_dir = False
    stage_dir = None
    for line in lines:
        if in_stage_dir:
            stage_dir.append(line)
            if ']' in line:
                result.append(' '.join(stage_dir))
                in_stage_dir = False
                stage_dir = None
        else:
            if '[' in line and not ']' in line:
                in_stage_dir = True
                stage_dir = [line]
            else:
                result.append(line)
    return result

def convert(lines):
    return map(compose(speech_prefixes()+[stage_direction]), lines)

def speech_prefixes():
    def speech_prefix(opts):
        orig, new = opts
        return lambda line: re.sub(r'^%s. (.+)$'%orig, r'\\%sspeaks \1'%new, line)
    return map(speech_prefix,
               [('DOL', 'dol'),
                ('FACE', 'face'),
                ('SUB', 'subtle'),
                ('LOVE', 'lovewit'),
                ('KAS', 'kastril'),
                ('DRUG', 'drugger'),
                ('ANA', 'ananias'),
                ('TRI', 'tribulation'),
                ('SUR', 'surly'),
                ('MAM', 'mammon'),
                ('DAP', 'dapper')])

def stage_direction(line):
    return re.sub(r'^(.*)\[(.*)\](.*)$', r'\1\\direct*{\2}\3', line)

def compose(funs):
    return lambda x: reduce(lambda acc, f: f(acc), funs, x)

def add_wrapper(lines):
    return prefix()+lines+suffix()

def write(lines):
    print('\n'.join(lines))

def prefix():
    return r'''
\documentclass{memoir}
\usepackage{dramatist}
\usepackage{dramatist-mods}

\begin{document}

\Character[Subtle, the Alchemist]{Subtle}{subtle}
\Character[Face, the housekeeper]{Face}{face}
\Character[Dol Common, their colleague]{Dol}{dol}
\Character[Dapper, a lawyer's clerk]{Dapper}{dapper}
\Character[Drugger, a tobacco man]{Drugger}{drugger}
\Character[Lovewit, master of the house]{Lovewit}{lovewit}
\Character[Sir Epicure Mammon, a knight]{Mammon}{mammon}
\Character[Pertinax Surly, a gamester]{Surly}{surly}
\Character[Tribulation Wholesome, a pastor of Amsterdam]{Tribulation}{tribulation}
\Character[Ananias, a deacon there]{Ananias}{ananias}
\Character[Kastril, the angry boy]{Kastril}{kastril}
\Character[Dame Pliant, his sister, a widow]{Pliant}{pliant}

\settowidth{\speakswidth}{\speaksfont{Subtle}\speaksdel\hspace{\Dlabelsep}}
\setlength\speaksindent{0in}

\DramPer

\begin{drama*}

'''.split('\n')

def suffix():
    return r'''
\end{drama*}
\end{document}
'''.split('\n')

if __name__ == '__main__':
    main()
